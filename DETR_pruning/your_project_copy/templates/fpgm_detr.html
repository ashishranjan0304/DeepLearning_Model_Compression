{% extends "base.html" %}

{% block title %}FPGM - DETR{% endblock %}
{% block header %}FPGM - DETR{% endblock %}

{% block content %}
    <form method="post" action="/fpgm_detr">
        <!-- Main parameters -->
        <label for="lr" title="Learning Rate">Learning Rate:</label>
        <input type="text" id="lr" name="lr" value="1e-4"><br>
        <label for="batch_size" title="Batch Size">Batch Size:</label>
        <input type="number" id="batch_size" name="batch_size" value="2"><br>
        <label for="resume" title="Path to the checkpoint file to resume training">Resume Path:</label>
        <input type="text" id="resume" name="resume" value="detr-r50_no-class-head.pth"><br>
        <label for="coco_path" title="Path to the COCO dataset">COCO Path:</label>
        <input type="text" id="coco_path" name="coco_path" value="../open-images-bus-trucks/"><br>
        <input type="checkbox" id="no_aux_loss" name="no_aux_loss">
        <label for="no_aux_loss" title="Disable auxiliary decoding losses">No Aux Loss</label><br>
        <input type="checkbox" id="eval" name="eval">
        <label for="eval" title="Run evaluation only">Eval</label><br>
        <label for="epochs" title="Number of Epochs">Epochs:</label>
        <input type="number" id="epochs" name="epochs" value="1"><br>
        <label for="num_workers" title="Number of Data Loading Workers">Number of Workers:</label>
        <input type="number" id="num_workers" name="num_workers" value="4"><br>
        <label for="output_dir" title="Output Directory">Output Directory:</label>
        <input type="text" id="output_dir" name="output_dir" value="RN1_RD0.check"><br>
        <label for="rate_norm" title="Normalization Rate">Rate Norm:</label>
        <input type="text" id="rate_norm" name="rate_norm" value="1"><br>
        <label for="rate_dist" title="Distance Rate">Rate Dist:</label>
        <input type="text" id="rate_dist" name="rate_dist" value="0.3"><br>
        <label for="layer_begin" title="Beginning Layer Index">Layer Begin:</label>
        <input type="number" id="layer_begin" name="layer_begin" value="10"><br>
        <label for="layer_end" title="Ending Layer Index">Layer End:</label>
        <input type="number" id="layer_end" name="layer_end" value="140"><br>
        <label for="layer_inter" title="Layer Interval">Layer Inter:</label>
        <input type="number" id="layer_inter" name="layer_inter" value="2"><br>

        <!-- Advanced settings button -->
        <button type="button" onclick="toggleAdvanced()">Advanced Settings</button>
        <div id="advanced-settings" style="display: none;">
            <h3>Advanced Settings</h3>
            <!-- Advanced parameters -->
            <label for="lr_backbone" title="Backbone Learning Rate">Learning Rate Backbone:</label>
            <input type="text" id="lr_backbone" name="lr_backbone"><br>
            <label for="weight_decay" title="Weight Decay">Weight Decay:</label>
            <input type="text" id="weight_decay" name="weight_decay"><br>
            <label for="clip_max_norm" title="Gradient Clipping Max Norm">Clip Max Norm:</label>
            <input type="text" id="clip_max_norm" name="clip_max_norm"><br>
            <label for="nclasses" title="Number of Classes">Number of Classes:</label>
            <input type="number" id="nclasses" name="nclasses"><br>
            <label for="frozen_weights" title="Frozen Weights Path">Frozen Weights:</label>
            <input type="text" id="frozen_weights" name="frozen_weights"><br>
            <label for="backbone" title="Backbone">Backbone:</label>
            <input type="text" id="backbone" name="backbone"><br>
            <input type="checkbox" id="dilation" name="dilation">
            <label for="dilation" title="Use Dilation">Dilation</label><br>
            <label for="position_embedding" title="Position Embedding">Position Embedding:</label>
            <input type="text" id="position_embedding" name="position_embedding"><br>
            <label for="enc_layers" title="Encoding Layers">Encoding Layers:</label>
            <input type="number" id="enc_layers" name="enc_layers"><br>
            <label for="dec_layers" title="Decoding Layers">Decoding Layers:</label>
            <input type="number" id="dec_layers" name="dec_layers"><br>
            <label for="dim_feedforward" title="Feedforward Dimension">Dim Feedforward:</label>
            <input type="number" id="dim_feedforward" name="dim_feedforward"><br>
            <label for="hidden_dim" title="Hidden Dimension">Hidden Dim:</label>
            <input type="number" id="hidden_dim" name="hidden_dim"><br>
            <label for="dropout" title="Dropout">Dropout:</label>
            <input type="text" id="dropout" name="dropout"><br>
            <label for="nheads" title="Number of Heads">Number of Heads:</label>
            <input type="number" id="nheads" name="nheads"><br>
            <label for="num_queries" title="Number of Queries">Number of Queries:</label>
            <input type="number" id="num_queries" name="num_queries"><br>
            <input type="checkbox" id="pre_norm" name="pre_norm">
            <label for="pre_norm" title="Use Pre-norm">Pre Norm</label><br>
            <input type="checkbox" id="masks" name="masks">
            <label for="masks" title="Train Segmentation Head">Masks</label><br>
            <label for="set_cost_class" title="Class Coefficient in Matching Cost">Set Cost Class:</label>
            <input type="text" id="set_cost_class" name="set_cost_class"><br>
            <label for="set_cost_bbox" title="Bounding Box Coefficient in Matching Cost">Set Cost BBox:</label>
            <input type="text" id="set_cost_bbox" name="set_cost_bbox"><br>
            <label for="set_cost_giou" title="GIoU Coefficient in Matching Cost">Set Cost GIoU:</label>
            <input type="text" id="set_cost_giou" name="set_cost_giou"><br>
            <label for="mask_loss_coef" title="Mask Loss Coefficient">Mask Loss Coef:</label>
            <input type="text" id="mask_loss_coef" name="mask_loss_coef"><br>
            <label for="dice_loss_coef" title="Dice Loss Coefficient">Dice Loss Coef:</label>
            <input type="text" id="dice_loss_coef" name="dice_loss_coef"><br>
            <label for="bbox_loss_coef" title="Bounding Box Loss Coefficient">BBox Loss Coef:</label>
            <input type="text" id="bbox_loss_coef" name="bbox_loss_coef"><br>
            <label for="giou_loss_coef" title="GIoU Loss Coefficient">GIoU Loss Coef:</label>
            <input type="text" id="giou_loss_coef" name="giou_loss_coef"><br>
            <label for="eos_coef" title="Relative Classification Weight of No-object Class">EOS Coef:</label>
            <input type="text" id="eos_coef" name="eos_coef"><br>
            <label for="dataset_file" title="Dataset File">Dataset File:</label>
            <input type="text" id="dataset_file" name="dataset_file"><br>
            <label for="coco_panoptic_path" title="COCO Panoptic Dataset Path">COCO Panoptic Path:</label>
            <input type="text" id="coco_panoptic_path" name="coco_panoptic_path"><br>
            <input type="checkbox" id="remove_difficult" name="remove_difficult">
            <label for="remove_difficult" title="Remove Difficult Instances">Remove Difficult</label><br>
            <label for="device" title="Device">Device:</label>
            <input type="text" id="device" name="device"><br>
            <label for="seed" title="Random Seed">Seed:</label>
            <input type="number" id="seed" name="seed"><br>
            <label for="start_epoch" title="Start Epoch">Start Epoch:</label>
            <input type="number" id="start_epoch" name="start_epoch"><br>
            <label for="world_size" title="World Size">World Size:</label>
            <input type="number" id="world_size" name="world_size"><br>
            <label for="dist_url" title="Distributed Training URL">Dist URL:</label>
            <input type="text" id="dist_url" name="dist_url"><br>
            <label for="dist_type" title="Type of Distance">Dist Type:</label>
            <input type="text" id="dist_type" name="dist_type"><br>
            <label for="epoch_prune" title="Prune Epoch">Epoch Prune:</label>
            <input type="number" id="epoch_prune" name="epoch_prune"><br>
            <input type="checkbox" id="use_cuda" name="use_cuda">
            <label for="use_cuda" title="Use CUDA">Use CUDA</label><br>
            <label for="learning_rate" title="Learning Rate (Pruning)">Learning Rate:</label>
            <input type="text" id="learning_rate" name="learning_rate"><br>
            <label for="print_freq" title="Print Frequency">Print Frequency:</label>
            <input type="number" id="print_freq" name="print_freq"><br>
        </div>
        
        <button type="submit">Run Command</button>
    </form>
    
    {% if output %}
    <div>
        <h2>Output:</h2>
        <pre>{{ output }}</pre>
    </div>
    {% endif %}
{% endblock %}

{% block scripts %}
<script>
    function toggleAdvanced() {
        var advancedSettings = document.getElementById('advanced-settings');
        advancedSettings.style.display = advancedSettings.style.display === 'none' ? 'block' : 'none';
    }
</script>
{% endblock %}
